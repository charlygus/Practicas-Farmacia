




<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguimiento PrÃ¡cticas Farmacia ðŸ’Š</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        .status-pendiente { @apply bg-yellow-100 text-yellow-800 border border-yellow-200; }
        .status-respondido { @apply bg-blue-100 text-blue-800 border border-blue-200; }
        .status-entrevista { @apply bg-green-100 text-green-800 border border-green-200; }
        .status-no { @apply bg-red-100 text-red-800 border border-red-200; }
        body { background-color: #f3f4f6; }
    </style>
</head>
<body class="text-gray-800 font-sans antialiased">

    <div class="max-w-6xl mx-auto p-4 sm:p-8">
        <header class="mb-8 flex flex-col sm:flex-row justify-between items-center bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
            <div>
                <h1 class="text-2xl sm:text-3xl font-extrabold text-teal-600 tracking-tight">ðŸ’Š Mis PrÃ¡cticas de Farmacia</h1>
                <p class="text-gray-400 mt-1 text-sm">Panel de control de candidaturas</p>
            </div>
            <div class="mt-4 sm:mt-0 text-right">
                <span class="block text-xs text-gray-400 uppercase tracking-wider font-semibold">Estado de Solicitudes</span>
                <span id="stats" class="font-bold text-xl text-gray-800">Cargando...</span>
            </div>
        </header>

        <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-100">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-100">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">Farmacia / Email</th>
                            <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">UbicaciÃ³n</th>
                            <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">Estado</th>
                            <th class="px-6 py-4 text-left text-xs font-bold text-gray-400 uppercase tracking-wider">Notas</th>
                        </tr>
                    </thead>
                    <tbody id="lista-farmacias" class="divide-y divide-gray-100">
                        </tbody>
                </table>
            </div>
        </div>

        <footer class="mt-8 text-center text-xs text-gray-400">
            <p>Sincronizado con Google Sheets â€¢ Actualiza la pÃ¡gina para ver cambios</p>
        </footer>
    </div>

    <script>
        // TU ENLACE YA CONFIGURADO:
        const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTHMTvkxxKH3An0VqizcHI2qYCcBfzLKyLjrhs7klbR_UyrTmy4f5M2aJurg9Vutb5VjEPLJxZEdX-r/pub?output=csv';

        function init() {
            Papa.parse(sheetUrl, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    renderTable(results.data);
                    updateStats(results.data);
                },
                error: function(err) {
                    console.error("Error:", err);
                    document.getElementById('lista-farmacias').innerHTML = `<tr><td colspan="4" class="p-6 text-center text-red-400 font-medium">No se pudieron cargar los datos. Verifica que el Sheet tenga datos.</td></tr>`;
                }
            });
        }

        function renderTable(data) {
            const tbody = document.getElementById('lista-farmacias');
            tbody.innerHTML = '';

            // Ordenar: Respondidos primero, luego pendientes
            data.sort((a, b) => {
                const estadoA = (a.Estado || '').toLowerCase();
                const estadoB = (b.Estado || '').toLowerCase();
                if (estadoA === 'pendiente') return 1;
                if (estadoB === 'pendiente') return -1;
                return 0;
            });

            data.forEach(row => {
                if (!row.FARMACIA) return;

                let statusClass = 'bg-gray-50 text-gray-600 border border-gray-200';
                const est = row.ESTADO ? row.ESTADO.toLowerCase() : 'pendiente';
                
                if (est.includes('pendiente')) statusClass = 'status-pendiente';
                else if (est.includes('respondido')) statusClass = 'status-respondido';
                else if (est.includes('entrevista') || est.includes('si')) statusClass = 'status-entrevista';
                else if (est.includes('no') || est.includes('rechaza')) statusClass = 'status-no';

                const tr = document.createElement('tr');
                tr.className = "hover:bg-gray-50 transition-colors duration-150";
                tr.innerHTML = `
                    <td class="px-6 py-4">
                        <div class="font-bold text-gray-800">${row.FARMACIA}</div>
                        <div class="text-xs text-teal-600 font-mono mt-1">${row.EMAIL}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-600">
                            ${row.LOCALIDAD}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full shadow-sm ${statusClass}">
                            ${row.ESTADO || 'Pendiente'}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-500 italic">
                        ${row.NOTAS || ''}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function updateStats(data) {
            const total = data.length;
            const answers = data.filter(r => r.Estado && !r.Estado.toLowerCase().includes('pendiente')).length;
            const percent = total > 0 ? Math.round((answers / total) * 100) : 0;
            
            document.getElementById('stats').innerHTML = `
                <span class="text-teal-600">${answers}</span> <span class="text-gray-400 font-normal">/ ${total} respondidas</span>
                <div class="w-full bg-gray-200 rounded-full h-1.5 mt-2 overflow-hidden">
                    <div class="bg-teal-500 h-1.5 rounded-full" style="width: ${percent}%"></div>
                </div>
            `;
        }

        init();
    </script>
</body>
</html>
